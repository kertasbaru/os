#!/bin/bash
# //====================================================
# //  Newbie Store - Copy 2024
# //====================================================
# //  System Request : DEB 9-12 / UBUNTU 18-24
# //  Author         : Kurniawan Setiadi
# //  Develop        : Newbie Store
# //  email          : Newbiestore09@gmail.com
# //  telegram       : https://t.me/newbie_store24
# //====================================================
clear
REDBG="\033[41m"  
WHITEBLD="\033[1;37m"
WHITE="\033[1;37m" 
NC="\033[0m"         
GREEN="\033[96;1m"
REDBLD="\033[0m\033[91;1m"
Green="\e[92;1m"
RED="\033[1;31m"
YELLOW="\033[33m"
BLUE="\033[36m"
GREENBG="\033[42;37m"
print_rainbow() {
    local text="$1"
    local warna_file="/etc/warna"

    # Inisialisasi warna default
    local start_r=0 start_g=255 start_b=150
    local mid_r=0 mid_g=150 mid_b=255
    local end_r=0 end_g=255 end_b=150

    # Fungsi untuk membaca nilai numerik dari file
    function get_value() {
        local key="$1"
        local value=$(grep -E "^$key=" "$warna_file" | cut -d'=' -f2 | tr -d '[:space:]')
        echo "${value:-0}"
    }

    # Jika file warna ada, baca isinya
    if [[ -f "$warna_file" ]]; then
        start_r=$(get_value "start_r")
        start_g=$(get_value "start_g")
        start_b=$(get_value "start_b")

        mid_r=$(get_value "mid_r")
        mid_g=$(get_value "mid_g")
        mid_b=$(get_value "mid_b")

        end_r=$(get_value "end_r")
        end_g=$(get_value "end_g")
        end_b=$(get_value "end_b")
    fi

    # Jalankan awk dengan warna yang sudah dimuat dari file
    echo "$text" | awk -v start_r="$start_r" -v start_g="$start_g" -v start_b="$start_b" \
                        -v mid_r="$mid_r" -v mid_g="$mid_g" -v mid_b="$mid_b" \
                        -v end_r="$end_r" -v end_g="$end_g" -v end_b="$end_b" '
    {
        len = length($0);
        for (i = 1; i <= len; i++) {
            progress = (i - 1) / (len - 1);
            if (progress < 0.5) {
                factor = progress * 2;
                r = int((1 - factor) * start_r + factor * mid_r);
                g = int((1 - factor) * start_g + factor * mid_g);
                b = int((1 - factor) * start_b + factor * mid_b);
            } else {
                factor = (progress - 0.5) * 2;
                r = int((1 - factor) * mid_r + factor * end_r);
                g = int((1 - factor) * mid_g + factor * end_g);
                b = int((1 - factor) * mid_b + factor * end_b);
            }
            printf "\033[38;2;%d;%d;%dm%s", r, g, b, substr($0, i, 1);
        }
        print "\033[0m";
    }'
}
garis(){
print_rainbow " â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
}
garis_bawah(){
print_rainbow " â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
}
garis_atas(){
print_rainbow " â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
}
garis_tebal(){
print_rainbow " â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
}
center() {
    BOX_WIDTH=48
    TEXT="$1"
    TEXT_LENGTH=${#TEXT}
    TEXT_CLEAN=$(echo -e "$TEXT" | sed 's/\x1b\[[0-9;]*m//g')
    TEXT_LENGTH=${#TEXT_CLEAN}
    # Hitung padding
    LEFT_PADDING=$(( (BOX_WIDTH - TEXT_LENGTH) / 2 ))
    RIGHT_PADDING=$(( BOX_WIDTH - TEXT_LENGTH - LEFT_PADDING ))

    # Cetak dengan warna menggunakan printf
    printf "%*s%s%*s\n" "$LEFT_PADDING" "" "$TEXT" "$RIGHT_PADDING" ""
}
function Loading() {
BOX_WIDTH=48
TEXT="[ PROCESSING, PLEASE WAIT.. ] "
TEXT_LENGTH=${#TEXT}
LEFT_PADDING=$(( (BOX_WIDTH - TEXT_LENGTH) / 2 ))
RIGHT_PADDING=$(( BOX_WIDTH - TEXT_LENGTH - LEFT_PADDING ))
LEFT_SPACE=$(printf '%*s' $LEFT_PADDING '')
RIGHT_SPACE=$(printf '%*s' $RIGHT_PADDING '')
print_rainbow " â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
print_rainbow " ${LEFT_SPACE}${TEXT}${RIGHT_SPACE}"
print_rainbow " â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
}

function Newbie_Banner() {
BOX_WIDTH=48
TEXT="[ MENU ADMIN ] "
TEXT_LENGTH=${#TEXT}
LEFT_PADDING=$(( (BOX_WIDTH - TEXT_LENGTH) / 2 ))
RIGHT_PADDING=$(( BOX_WIDTH - TEXT_LENGTH - LEFT_PADDING ))
LEFT_SPACE=$(printf '%*s' $LEFT_PADDING '')
RIGHT_SPACE=$(printf '%*s' $RIGHT_PADDING '')
print_rainbow " â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
print_rainbow " ${LEFT_SPACE}${TEXT}${RIGHT_SPACE}"
print_rainbow " â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
}
function Sc_Credit(){
nama=$(cat /etc/xray/username)
BOX_WIDTH=48
TEXT="SCRIPT BY $nama"
TEXT_LENGTH=${#TEXT}
LEFT_PADDING=$(( (BOX_WIDTH - TEXT_LENGTH) / 2 ))
RIGHT_PADDING=$(( BOX_WIDTH - TEXT_LENGTH - LEFT_PADDING ))
LEFT_SPACE=$(printf '%*s' $LEFT_PADDING '')
RIGHT_SPACE=$(printf '%*s' $RIGHT_PADDING '')
print_rainbow " â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
print_rainbow " ${LEFT_SPACE}${TEXT}${RIGHT_SPACE}"
print_rainbow " â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
read -p "Tekan Enter untuk kembali ke menu..."
regisip
exit 0
}
MYIP=$(curl -sS ipv4.icanhazip.com)
PROFIL=$(curl -sS https://raw.githubusercontent.com/kertasbaru/izin/main/ip | grep -wE $MYIP | awk '{print $2}')
TOKEN=$(cat /etc/github/api)
REPO="https://github.com/kertasbaru/izin/"
EMAIL=$(cat /etc/github/email)
USER=$(cat /etc/github/username)
data_ip=$(curl -sS https://raw.githubusercontent.com/kertasbaru/izin/main/ip | grep -wE $MYIP | awk '{print $6}')
checking_sc() {
if [[ -n "$data_ip" || "$data_ip" -gt 0 ]]; then
    echo -ne
  else
    # Tanggal sekarang lebih besar dari tanggal expired, atau format salah
echo -e "\033[1;93mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\033[0m"
echo -e "\033[41;1m âš ï¸       AKSES DI TOLAK         âš ï¸ \033[0m"
echo -e "\033[1;93mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\033[0m"
echo -e ""
echo -e "        \033[91;1mâŒ SCRIPT LOCKED âŒ\033[0m"
echo -e ""
echo -e "  \033[0;33mðŸ”’ Your VPS\033[0m $ipsaya \033[0;33mHas been Banned\033[0m"
echo -e ""
echo -e "  \033[91mâš ï¸  Masa Aktif Sudah Habis âš ï¸\033[0m"
echo -e "  \033[0;33mðŸ’¡ Beli izin resmi hanya dari Admin!\033[0m"
echo -e ""
echo -e "  \033[92;1mðŸ“ž Contact Admin:\033[0m"
echo -e "  \033[96mðŸŒ Telegram: https://t.me/WuzzSTORE\033[0m"
echo -e "  \033[96mðŸ“± WhatsApp: https://wa.me/6287760204418\033[0m"
echo -e ""
echo -e "\033[1;93mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\033[0m"
exit 1
  fi
}
checking_sc
# Definisi warna
y='\033[1;93m'  # Kuning
c='\033[0;36m'  # Cyan
g='\033[0;32m'  # Hijau
r='\033[1;31m'  # Merah
NC='\033[0m'    # Reset warna

# Fungsi untuk menampilkan menu utama
show_menu() {
    clear
Newbie_Banner
    echo -e "${WHITEBLD}  1.) Cek VPS Online${NC}"
    echo -e "${WHITEBLD}  2.) Replace IP Offline${NC}"
    echo -e "${WHITEBLD}  3.) Input Data VPS${NC}"  # Tambahan opsi baru
    echo -e "${WHITEBLD}  4.) Hubungkan VPS${NC}"
    echo -e "${WHITEBLD}  5.) Pasang SC ke VPS${NC}"
    echo -e "${WHITEBLD}  6.) Rebuild VPS${NC}"
    echo -e "${WHITEBLD}  7.) Ganti URL Izin${NC}"
    echo -e "${WHITEBLD}  8.) Hapus Data Inventory${NC}"
    echo -e "${r}  x.) Back To Menu${NC}"
garis
    echo -ne "${y}Pilih opsi [1-8/x]: ${NC}"
}

Fungsi untuk input data VPS
input_data_vps() {
    clear
    echo -e "${c}Menambahkan data VPS ke file inventory...${NC}"
    INVENTORY_FILE="/root/inventory.ini"

    if [[ ! -f $INVENTORY_FILE ]]; then
        echo "[vps_group]" > $INVENTORY_FILE
        echo -e "${y}File inventory baru dibuat.${NC}"
    fi

    while true; do
        echo -ne "${y}Masukkan nama VPS (atau 'exit' untuk kembali): ${NC}"
        read -r vps_name
        [[ $vps_name == "exit" ]] && break

        echo -ne "${y}Masukkan IP VPS: ${NC}"
        read -r ansible_host

        echo -ne "${y}Masukkan domain (${r}wajib sudah terpointing!${NC}): ${NC}"
        read -r domain

        # Validasi input
        if [[ -z $vps_name || -z $ansible_host || -z $domain ]]; then
            echo -e "${r}Data tidak boleh kosong. Coba lagi.${NC}"
            continue
        fi

        echo "${vps_name} ansible_host=${ansible_host} ansible_user=root domain=${domain} ansible_python_interpreter=/usr/bin/python3" >> "$INVENTORY_FILE"
        echo -e "${WHITEBLD}Data VPS berhasil ditambahkan.${NC}\n"
        sleep 0.5 && clear
    done

    echo -e "${WHITEBLD}Selesai menambahkan data VPS.${NC}"
    sleep 0.5
    menu_ftr
}

hapus_inventory() {
    INVENTORY_FILE="/root/inventory.ini"
    if [[ -f $INVENTORY_FILE ]]; then
        rm "$INVENTORY_FILE"
        echo -e "${WHITEBLD}File inventory telah dihapus.${NC}"
    else
        echo -e "${r}File inventory tidak ditemukan.${NC}"
    fi
    echo -e "\n${WHITEBLD}Tekan Enter untuk kembali ke menu...${NC}"
    read -r
    menu_ftr
}
# Fungsi untuk cek VPS online
cek_vps() {
    cek_vps_online
    echo -e "\n${WHITEBLD}Tugas selesai. Tekan Enter untuk kembali ke menu...${NC}"
    read -r
    menu_ftr
}

# Fungsi untuk replace IP offline
replace_ip_offline() {
    repip
}

# Fungsi untuk ganti URL izin
ganti_url_izin() {
    if [ -f "/root/.url" ]; then
        rm /root/.url
        echo -e "${WHITEBLD}URL izin telah dihapus. Tekan Enter untuk kembali ke menu...${NC}"
    else
        echo -e "${r}File /root/.url tidak ditemukan. Tidak ada URL yang dihapus.${NC}"
        echo -e "${r}Tekan Enter untuk kembali ke menu...${NC}"
    fi
    read -r
    menu_ftr
}

# Fungsi untuk hubungkan VPS
hubungkan_vps() {
    clear
    # File inventory
    INVENTORY_FILE="/root/inventory.ini"

    # Memastikan sshpass sudah terinstal
    if ! command -v sshpass &> /dev/null; then
        echo -e "${y}sshpass tidak ditemukan. Menginstal sshpass...${NC}"
        apt update -y &> /dev/null
        apt install sshpass -y &> /dev/null
        echo -e "${WHITEBLD}sshpass berhasil diinstal.${NC}"
    fi

    # Menghapus entri known_hosts untuk memastikan koneksi sukses
    echo -e "${c}Menghapus semua entri SSH known_hosts...${NC}"
    rm -f /root/.ssh/known_hosts

    # Memeriksa apakah file inventory ada
    if [[ ! -f $INVENTORY_FILE ]]; then
        echo -e "${r}File inventory tidak ditemukan: $INVENTORY_FILE${NC}"
        return
    fi

# Menanyakan apakah semua VPS memiliki password yang sama
echo -ne "${y}Apakah semua VPS memiliki password yang sama? (Y/n): ${NC}"
read -r same_password

if [[ "${same_password,,}" == "y" ]]; then
    # Jika semua VPS memiliki password yang sama
    while true; do
        echo -ne "${y}Masukkan password untuk semua VPS: ${NC}"
        read -rs password
        echo ""

        # Memastikan password tidak kosong
        if [[ -z "$password" ]]; then
            echo -e "${r}Password tidak boleh kosong. Silakan coba lagi.${NC}"
            continue
        fi

        # Menghubungkan ke semua VPS
        echo -e "${c}Menghubungkan ke semua VPS yang terdaftar...${NC}"

        while IFS= read -r line; do
            # Skip baris kosong, komentar, atau grup
            [[ -z $line || $line =~ ^# || $line =~ ^\[.*\]$ ]] && continue

            # Memecah data inventory berdasarkan pola
            vps_name=$(echo "$line" | awk '{print $1}')
            ansible_host=$(echo "$line" | grep -oP 'ansible_host=\K\S+')
            ansible_user=$(echo "$line" | grep -oP 'ansible_user=\K\S+')

            echo -e "${y}Menghubungkan ke VPS: ${vps_name} (${ansible_host})...${NC}"

            sshpass -p "$password" ssh-copy-id -o StrictHostKeyChecking=no "${ansible_user}@${ansible_host}"
            if [[ $? -ne 0 ]]; then
                echo -e "${r}Gagal menghubungkan ke ${vps_name}. Silakan periksa password atau konfigurasi VPS.${NC}"
                continue
            fi
        done < "$INVENTORY_FILE"

        echo -e "${WHITEBLD}Proses selesai! Semua VPS telah terhubung.${NC}"
        break
    done
else
    # Jika password berbeda, meminta user memilih VPS dan memasukkan password manual
    echo -e "${y}Pilih VPS yang ingin Anda hubungkan: ${NC}"

    # Menampilkan daftar VPS
    declare -A vps_data
    index=0
    while IFS= read -r line; do
        # Skip baris kosong, komentar, atau grup
        [[ -z $line || $line =~ ^# || $line =~ ^\[.*\]$ ]] && continue

        # Memecah data inventory berdasarkan pola
        vps_name=$(echo "$line" | awk '{print $1}')
        ansible_host=$(echo "$line" | grep -oP 'ansible_host=\K\S+')
        ansible_user=$(echo "$line" | grep -oP 'ansible_user=\K\S+')

        # Simpan data VPS dalam associative array
        vps_data["$index,name"]="$vps_name"
        vps_data["$index,host"]="$ansible_host"
        vps_data["$index,user"]="$ansible_user"

        ((index++))
        echo "$index) $vps_name"
    done < "$INVENTORY_FILE"

    # Meminta pengguna memilih VPS
    echo -ne "${y}Masukkan nomor VPS yang ingin Anda hubungkan: ${NC}"
    read -r vps_choice

    # Validasi input pengguna
    if [[ ! "$vps_choice" =~ ^[0-9]+$ ]] || [ "$vps_choice" -le 0 ] || [ "$vps_choice" -gt "$index" ]; then
        echo -e "${r}Pilihan tidak valid.${NC}"
        exit 1
    fi

    selected_vps_index=$((vps_choice - 1))
    selected_vps="${vps_data["$selected_vps_index,name"]}"
    selected_host="${vps_data["$selected_vps_index,host"]}"
    selected_user="${vps_data["$selected_vps_index,user"]}"

    echo -e "${y}Anda memilih VPS: ${selected_vps}${NC}"

    while true; do
        echo -ne "${y}Masukkan password untuk VPS ${selected_vps}: ${NC}"
        read -rs password
        echo ""

        if [[ -z "$password" ]]; then
            echo -e "${r}Password tidak boleh kosong. Silakan coba lagi.${NC}"
            continue
        fi

        sshpass -p "$password" ssh-copy-id -o StrictHostKeyChecking=no "${selected_user}@${selected_host}"
        if [[ $? -eq 0 ]]; then
            echo -e "${WHITEBLD}Berhasil menghubungkan ke VPS ${selected_vps}.${NC}"
            break
        else
            echo -e "${r}Password salah atau koneksi gagal. Silakan coba lagi.${NC}"
        fi
    done
fi

echo -e "\nTekan Enter untuk kembali ke menu..."
    read -r
menu_ftr

}


# Fungsi untuk pasang SC ke VPS
pasang_sc_ke_vps() {
clear
    # Cek apakah file inventory.ini ada
    if [[ ! -f /root/inventory.ini ]]; then
        echo -e "${r}File inventory.ini tidak ditemukan.${NC}"
        echo -e "${y}Silakan atur penggantian VPS dan hubungkan terlebih dahulu sebelum melanjutkan.${NC}"
        return
    fi

    # Cek apakah file install.yml ada, jika tidak buat file baru
    if [[ ! -f /root/install.yml ]]; then
        echo -e "${y}File install.yml tidak ditemukan, membuat file baru...${NC}"
        cat <<EOF > /root/install.yml
---
- name: Install script on multiple VPS without prompts
  hosts: vps_group  # Menggunakan grup vps_group
  become: true  # Menjalankan playbook sebagai root
  environment:
    DEBIAN_FRONTEND: noninteractive  # Menghindari prompt selama instalasi
  vars:
    default_domain: example.t.me/WuzzSTORE  # Default domain jika tidak didefinisikan di inventory
  tasks:
    # Instalasi dependensi tanpa prompt
    - name: Install dependencies (wget, screen, curl, openssh-server, jq)
      apt:
        name:
          - wget
          - screen
          - curl
          - openssh-server
          - jq
        state: present
        update_cache: yes
    # Install python3-apt untuk kompatibilitas Ansible
    - name: Install python3-apt to ensure Ansible works
      apt:
        name: python3-apt
        state: present
        update_cache: yes
    # Unduh skrip Install.sh
    - name: Download Install script
      get_url:
        url: https://raw.githubusercontent.com/kertasbaru/vip/main/Install.sh
        dest: /root/Install.sh
    # Berikan izin eksekusi pada skrip
    - name: Make Install script executable
      file:
        path: /root/Install.sh
        mode: '0755'
    # Jalankan skrip dalam sesi screen dengan input otomatis
    - name: Run Install.sh in screen with predefined input
      shell: |
        screen -S install -dm bash -c "/root/Install.sh {{ inventory_hostname }} {{ domain | default(default_domain) }}"
EOF
    fi

    # Pastikan semua VPS memiliki Ansible Playbook
    echo -e "${c}Memeriksa apakah Ansible Playbook sudah terinstal di VPS...${NC}"
    ansible-playbook --version &> /dev/null
    if [[ $? -ne 0 ]]; then
        echo -e "${y}Ansible Playbook tidak ditemukan. Memasang Ansible Playbook...${NC}"
        apt update -y &> /dev/null
        apt install ansible -y &> /dev/null
    fi

    # Pastikan python3-apt terinstal
    echo -e "${c}Memeriksa apakah python3-apt terinstal di VPS...${NC}"
    apt list --installed | grep -q python3-apt || apt install python3-apt -y &> /dev/null

    # Jalankan playbook untuk memasang SC
    echo -e "${c}Menjalankan playbook untuk memasang script pada VPS...${NC}"
    ansible-playbook -i /root/inventory.ini /root/install.yml

    echo -e "${WHITEBLD}Pemasangan script selesai.${NC}"
    echo -e "\n${WHITEBLD}Tugas selesai. Tekan Enter untuk kembali ke menu...${NC}"
    read -r
    menu_ftr
}
rebuild_vps() {
    clear
    # Cek apakah file inventory.ini ada
    if [[ ! -f /root/inventory.ini ]]; then
        echo -e "${r}File inventory.ini tidak ditemukan.${NC}"
        echo -e "${y}Silakan tambahkan inventory terlebih dahulu sebelum melanjutkan.${NC}"
        return
    fi

    # Tampilkan daftar VPS dari inventory.ini
    echo -e "${c}Daftar VPS yang tersedia:${NC}"
    mapfile -t vps_list < <(grep -E 'ansible_host=' /root/inventory.ini | awk '{print $1, $2}')
    if [[ ${#vps_list[@]} -eq 0 ]]; then
        echo -e "${r}Tidak ada VPS yang ditemukan di inventory.ini.${NC}"
        return
    fi

    for i in "${!vps_list[@]}"; do
        vps_name=$(echo "${vps_list[i]}" | awk '{print $1}')
        vps_ip=$(echo "${vps_list[i]}" | awk -F'=' '{print $2}')
        echo "$((i+1)). $vps_name ($vps_ip)"
    done

    # Pilih VPS
    echo -ne "${y}Pilih VPS yang ingin di-rebuild [1-${#vps_list[@]}]: ${NC}"
    read -r vps_choice
    if [[ ! $vps_choice =~ ^[0-9]+$ ]] || (( vps_choice < 1 || vps_choice > ${#vps_list[@]} )); then
        echo -e "${r}Pilihan tidak valid.${NC}"
        return
    fi

    selected_vps=$(echo "${vps_list[vps_choice-1]}" | awk '{print $1}')
    selected_ip=$(grep -E "^${selected_vps}" /root/inventory.ini | awk '{print $2}' | cut -d'=' -f2)
    clear
    echo -e "${c}VPS terpilih: $selected_vps ($selected_ip)${NC}"

    # Pilih OS yang ingin digunakan
    echo -e "${c}Pilih OS untuk VPS:${NC}"
    echo "1. Ubuntu 20.04"
    echo "2. Ubuntu 22.04"
    echo "3. Ubuntu 24.04"
    echo "4. Debian 10"
    echo "5. Debian 11"
    echo "6. Debian 12"
    echo -ne "${y}Masukkan pilihan OS [1-6]: ${NC}"
    read -r os_choice

    case $os_choice in
        1) os_selected="Ubuntu 20.04" ;;
        2) os_selected="Ubuntu 22.04" ;;
        3) os_selected="Ubuntu 24.04" ;;
        4) os_selected="Debian 10" ;;
        5) os_selected="Debian 11" ;;
        6) os_selected="Debian 12" ;;
        *) 
            echo -e "${r}Pilihan tidak valid.${NC}"
            return
            ;;
    esac

    # Meminta input password baru untuk VPS
    echo -ne "${y}Masukkan password baru untuk root VPS: ${NC}"
    read -s new_password
    echo

    # Validasi password (minimal 4 karakter)
    if [[ ${#new_password} -lt 4 ]]; then
        echo -e "${r}Password terlalu pendek. Minimal 4 karakter.${NC}"
        return
    fi
clear
    # Rebuild VPS dengan OS terpilih dan kata sandi baru
    echo -e "${c}Memulai reinstall OS pada VPS $selected_vps ($selected_ip)...${NC}"
    ssh root@"$selected_ip" "curl -O https://raw.githubusercontent.com/bin456789/reinstall/main/reinstall.sh && \
        printf '${new_password}\n${new_password}\n' | bash reinstall.sh ${os_selected} && reboot"

    echo -e "${WHITEBLD}Proses reinstall selesai. VPS akan reboot.${NC}"
    echo -e "\n${WHITEBLD}Tugas selesai. Tekan Enter untuk kembali ke menu...${NC}"
    read -r
    menu_ftr
}
# Fungsi lainnya tetap sama, hanya perubahan nomor menu
menu_ftr() {
    show_menu
    read -r option
    case $option in
        1)
            cek_vps
            ;;
        2)
            replace_ip_offline
            ;;
        3)
            input_data_vps  # Tambahan opsi input data VPS
            ;;
        4)
            hubungkan_vps
            ;;
        5)
            pasang_sc_ke_vps
            ;;
        6)
            rebuild_vps
            ;;
        7)
            ganti_url_izin
            ;;
        8)
            hapus_inventory
            ;;
        x)
            echo -e "${y}Kembali ke menu utama...${NC}"
            menu
            ;;
        *)
            echo -e "${r}Pilihan tidak valid, coba lagi.${NC}"
            menu_ftr
            ;;
    esac
}

# Menampilkan menu utama
menu_ftr
